<html><head></head>

<script lang="text/javascript">
  var mydata = {
    foo: 'bar',
    baz: 'omg',
  };
  function clearSelect(s) {
    while(s.length > 0) {
      s.remove(0);
    }
  }
  function addToSelect(i,s) {
      try {
        s.add(i, null);
      } catch(ex) {
        s.add(i); // IE
      }
  }
  function loadme() {
    var keys = document.getElementById("keys");
    clearSelect(keys);
    for(var key in mydata) {
      var k = document.createElement("option");
      k.text = key + ": " + mydata[key];
      k.value = key;
      addToSelect(k,keys);
    }
  }
  function getActive() {
    var s = document.getElementById("keys");
    var it;
    var i = false;
    for(it = 0; it < s.length; ++it) {
      if(s.options[it].selected) {
        i = s.options[it];
	break;
      }
    }
    return i;
  }
  function selectHandler() {
    var i = getActive();
    if(i) {
      var keybox   = document.getElementById("addkeybox");
      var valuebox = document.getElementById("addvaluebox");
      document.getElementById("delete").disabled = false;
      keybox.value = i.value;
      valuebox.value = mydata[i.value];
    }
  }
  function addHandler() {
    var key   = document.getElementById("addkeybox").value;
    var value = document.getElementById("addvaluebox").value;
    mydata[key] = value;
    loadme();
    typeyTypey();
  }
  function deleteHandler() {
    var i = getActive();
    if(i) {
      delete mydata[i.value];
      document.getElementById("delete").disabled = "disabled";
      loadme();
      typeyTypey();
    }
  }
  function typeyTypey() {
    var newkey = document.getElementById("addkeybox").value;
    for(var key in mydata) {
      if(key == newkey) {
        var it;
        var s = document.getElementById("keys");
        document.getElementById("add").value = "Change";
        document.getElementById("delete").disabled = false;
        for(it = 0; it < s.length; ++it) {
          if(s.options[it].key == key) {
            s.options[it].selected = true;
	    break;
          }
        }
	return;
      }
    }
    document.getElementById("add").value = "Add";
    document.getElementById("delete").disabled = "disabled";
  }
</script>
<style type="text/css">
#theform input,
#theform select {
/*width: 8em;*/
}
#theform select {
width: 100%;
}
</style>

<body onload="loadme();"><h1>hello</h1>

<form id="theform">
    <select multiple=multiple id="keys" onchange="selectHandler();" >
      <option>foo</option>
      <option>bar</option>
    </select>
    <br />
    <input type=text id=addkeybox value="new key" onchange="typeyTypey();" onkeypress="typeyTypey();" onkeyup="typeyTypey();">:
    <input type=text id=addvaluebox value="new value" />
    <input type=button id=add value="Add" onclick="addHandler()"; />
    <input type=button id=delete value=Delete disabled=disabled onclick="deleteHandler();"/>
</form>

</body>
</html>
