<html><head></head>

<script type="text/javascript" src="./underlays/jquery/ikiwiki/jquery.full.js"></script> 

<script lang="text/javascript">
  var mydata = {
    foo: 'bar',
    baz: 'omg',
  };
  function refreshSelect() {
    $('#keys option').remove();
    for(var key in mydata) {
      var v = $('<option>'+key + ": " + mydata[key]+'</option>').attr({
	value: key,
      }).appendTo('#keys');
    }
  }
  function selectHandler() {
    var selected = $('#keys option:selected');
    /* collapse multi-selection down to the last one. Note last one
       is sequence order, not selected order, unfortunately. */
    for(i = 0; i < selected.length - 1; ++i) {
      selected.eq(i).attr('selected', false);
    }
    if(selected) {
      $("#keybox").val(selected.val());
      $("#valuebox").val(mydata[selected.val()]);
      checkAddBox();
    }
  }
  function addHandler() {
    var key   = $("#keybox").attr('value');
    var value = $("#valuebox").attr('value');
    mydata[key] = value;
    refreshSelect();
    checkAddBox();
  }
  function deleteHandler() {
    delete mydata[$('#keybox').attr('value')];
    $("#delete").attr('disabled', 'disabled');
    refreshSelect();
    checkAddBox();
  }
  function checkAddBox() {
    var newkey = $("#keybox").attr('value');
    for(var key in mydata) {
      if(key == newkey) {
        $("#add").attr('value', "Change");
        $("#delete").attr('disabled', false);
	return;
      }
    }
    $("#add").attr('value', "Add");
    $("#delete").attr('disabled', 'disabled');
  }
</script>
<style type="text/css">
#theform input,
#theform select {
/*width: 8em;*/
}
#theform select {
width: 100%;
}
</style>

<body onload="refreshSelect();"><h1>hello</h1>

<form id="theform">
  <select multiple=multiple id="keys" onchange="selectHandler();" >
  </select>
  <br />
  <input type=text id=keybox value="new key" onchange="checkAddBox();" onkeypress="checkAddBox();" onkeyup="checkAddBox();">:
  <input type=text id=valuebox value="new value" />
  <input type=button id=add value="Add" onclick="addHandler()"; />
  <input type=button id=delete value=Delete disabled=disabled onclick="deleteHandler();"/>
</form>

</body>
</html>
